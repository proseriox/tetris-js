<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tetris</title>
  <style>
    #tetris {
      display: flex;
      flex-wrap: wrap;
      width: 200px;
      height: 400px;
      border: 1px solid black;
    }

    .cell {
      box-sizing: border-box;
      width: 20px;
      height: 20px;
      border: 1px solid white;
      background-color: gray;
    }
  </style>
</head>
<body>
<div id="tetris"></div>
<script>
  var board = [];
  var blockSize = 24; // 24 pixels per block
var currentBlock = {
  x: 0,
  y: 0,
  shape: [[1, 1], [1, 1]],
  color: "red"
};
var tetris = document.getElementById("tetris");

// Create the game board
for (var i = 0; i < 20; i++) {
  board[i] = [];
  for (var j = 0; j < 10; j++) {
    board[i][j] = 0;
    var cell = document.createElement("div");
    cell.className = "cell";
    tetris.appendChild(cell);
  }
}

// Draw the current block on the board
function drawBlock() {
  for (var i = 0; i < currentBlock.shape.length; i++) {
    for (var j = 0; j < currentBlock.shape[i].length; j++) {
      if (
              currentBlock.shape[i][j] == 1 &&
              currentBlock.y + i < board.length &&
              currentBlock.x + j < board[0].length
      ) {
        var cellIndex = (currentBlock.y + i) * 10 + (currentBlock.x + j);
        tetris.children[cellIndex].style.backgroundColor = currentBlock.color;
      }
    }
  }
}
  function drawBlock() {
    for (var i = 0; i < currentBlock.shape.length; i++) {
      for (var j = 0; j < currentBlock.shape[i].length; j++) {
        if (currentBlock.shape[i][j] == 1) {
          var block = document.createElement("div");
          block.className = "block";
          block.style.left = Math.round((currentBlock.x + j) * blockSize) + "px";
          block.style.top = Math.round((currentBlock.y + i) * blockSize) + "px";
          block.style.backgroundColor = currentBlock.color;
          tetris.appendChild(block);
          currentBlocks.push(block); // todo
        }
      }
    }
  }


// Clear the current block from the board
function clearBlock() {
  for (var i = 0; i < currentBlock.shape.length; i++) {
    for (var j = 0; j < currentBlock.shape[i].length; j++) {
      if (
              currentBlock.shape[i][j] == 1 &&
              currentBlock.y + i < board.length &&
              currentBlock.x + j < board[0].length
      ) {
        var cellIndex = (currentBlock.y + i) * 10 + (currentBlock.x + j);
        tetris.children[cellIndex].style.backgroundColor = "gray";
      }
    }
  }
}

// Move the current block down by one row
function moveBlockDown() {
  clearBlock();
  currentBlock.y++;
  drawBlock();
}

// Move the current block left by one column
function moveBlockLeft() {
  var canMove = true;
  for (var i = 0; i < currentBlock.shape.length; i++) {
    for (var j = 0; j < currentBlock.shape[i].length; j++) {
      if (
              currentBlock.shape[i][j] == 1 &&
              (currentBlock.x + j == 0 ||
                      board[currentBlock.y + i][currentBlock.x + j - 1] == 1)
      ) {
        canMove = false;
      }
    }
  }
  if (canMove) {
    clearBlock();
    currentBlock.x--;
    drawBlock();
  }
}

// Move the current block right by one column
function moveBlockRight() {
  console.log("moveBlockRight: currentBlock.x = " + currentBlock.x);
  var canMove = true;
  for (var i = 0; i < currentBlock.shape.length; i++) {
    for (var j = 0; j < currentBlock.shape[i].length; j++) {
      if (
              currentBlock.shape[i][j] == 1 &&
              (currentBlock.x + j == board[0].length - 1 ||
                      board[currentBlock.y + i][currentBlock.x + j + 1] == 1)
      ) {
        canMove = false;
      }
    }
  }
  if (canMove && currentBlock.x < board[0].length - currentBlock.shape[0].length) {
    clearBlock();
    currentBlock.x++;
    drawBlock();
  }
}


// Rotate the current block
function rotateBlock() {
  var newShape = [];
  for (var i = 0; i < currentBlock.shape[0].length; i++) {
    newShape[i] = [];
    for (var j = 0; j < currentBlock.shape.length; j++) {
      newShape[i][j] = currentBlock.shape[currentBlock.shape.length - j - 1][i];
    }
  }
  var canRotate = true;
  for (var i = 0; i < newShape.length; i++) {
    for (var j = 0; j < newShape[i].length; j++) {
      if (
              newShape[i][j] == 1 &&
              (currentBlock.y + i >= board.length ||
                      currentBlock.x + j >= board[0].length ||
                      currentBlock.x + j < 0 ||
                      board[currentBlock.y + i][currentBlock.x + j] == 1)
      ) {
        canRotate = false;
      }
    }
  }
  if (canRotate) {
    clearBlock();
    currentBlock.shape = newShape;
    drawBlock();
  }
}

// Add the current block to the board
function addBlockToBoard() {
  for (var i = 0; i < currentBlock.shape.length; i++) {
    for (var j = 0; j < currentBlock.shape[i].length; j++) {
      if (currentBlock.shape[i][j] == 1) {
        board[currentBlock.y + i][currentBlock.x + j] = currentBlock.color;
      }
    }
  }
}

// Start the game loop
drawBlock();
setInterval(function() {
  moveBlockDown();
  if (currentBlock.y == board.length - 2) {
    addBlockToBoard();
    currentBlock = {
      x: 0,
      y: 0,
      shape: [[1, 1], [1, 1]],
      color: "red"
    };
  }
}, 500);

// Handle keyboard events
document.addEventListener("keydown", function(event) {
  if (event.key == "ArrowLeft") {
    moveBlockLeft();
  } else if (event.key == "ArrowRight") {
    moveBlockRight();
  } else if (event.key == "ArrowUp") {
    rotateBlock();
  } else if (event.key == "ArrowDown") {
    moveBlockDown();
  }
});

document.addEventListener("keydown", function(event) {
  if (event.key == "ArrowLeft") {
    moveBlockLeft();
  } else if (event.key == "ArrowRight") {
    moveBlockRight();
  } else if (event.key == "ArrowUp") {
    rotateBlock();
  } else if (event.key == "ArrowDown") {
    moveBlockDown();
  }
});

</script>
</body>
</html>
